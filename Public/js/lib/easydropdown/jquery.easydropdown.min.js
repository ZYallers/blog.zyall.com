(function(B){function D(){this.isField=true,this.down=false,this.inFocus=false,this.disabled=false,this.cutOff=10,this.hasLabel=false,this.keyboardMode=false,this.nativeTouch=true,this.wrapperClass="dropdown",this.onChange=null}D.prototype={constructor:D,instances:{},init:function(G,E){var F=this;B.extend(F,E);F.$select=B(G);F.id=G.id;F.options=[];F.$options=F.$select.find("option");F.isTouch="ontouchend" in document;F.$select.removeClass(F.wrapperClass+" dropdown");if(F.$select.is(":disabled")){F.disabled=true}if(F.$options.length){F.$options.each(function(I){var H=B(this);if(H.is(":selected")){F.selected={index:I,title:H.text()};F.focusIndex=I}if(H.hasClass("label")&&I==0){F.hasLabel=true;F.label=H.text();H.attr("value","")}else{F.options.push({domNode:H[0],title:H.text(),value:H.val(),selected:H.is(":selected")})}});if(!F.selected){F.selected={index:0,title:F.$options.eq(0).text()};F.focusIndex=0}F.render()}},render:function(){var F=this,G=F.isTouch&&F.nativeTouch?" touch":"",E=F.disabled?" disabled":"";F.$container=F.$select.wrap('<div class="'+F.wrapperClass+G+E+'"><span class="old"/></div>').parent().parent();F.$active=B('<span class="selected">'+F.selected.title+"</span>").appendTo(F.$container);F.$carat=B('<span class="carat"/>').appendTo(F.$container);F.$scrollWrapper=B("<div><ul/></div>").appendTo(F.$container);F.$dropDown=F.$scrollWrapper.find("ul");F.$form=F.$container.closest("form");B.each(F.options,function(){var H=this,I=H.selected?' class="active"':"";F.$dropDown.append("<li"+I+' title="'+H.title+'">'+H.title+"</li>")});F.$items=F.$dropDown.find("li");if(F.cutOff&&F.$items.length>F.cutOff){F.$container.addClass("scrollable")}F.getMaxHeight();if(F.isTouch&&F.nativeTouch){F.bindTouchHandlers()}else{F.bindHandlers()}},getMaxHeight:function(){var F=this;F.maxHeight=0;for(i=0;i<F.$items.length;i++){var E=F.$items.eq(i);F.maxHeight+=E.outerHeight();if(F.cutOff==i+1){break}}},bindTouchHandlers:function(){var E=this;E.$container.on("click.easyDropDown",function(){E.$select.focus()});E.$select.on({change:function(){var H=B(this).find("option:selected"),G=H.text(),F=H.val();E.$active.text(G);if(typeof E.onChange==="function"){E.onChange.call(E.$select[0],{title:G,value:F})}},focus:function(){E.$container.addClass("focus")},blur:function(){E.$container.removeClass("focus")}})},bindHandlers:function(){var E=this;E.query="";E.$container.on({"click.easyDropDown":function(){if(!E.down&&!E.disabled){E.open()}else{E.close()}},"mousemove.easyDropDown":function(){if(E.keyboardMode){E.keyboardMode=false}}});B("body").on("click.easyDropDown."+E.id,function(G){var F=B(G.target),H=E.wrapperClass.split(" ").join(".");if(!F.closest("."+H).length&&E.down){E.close()}});E.$items.on({"click.easyDropDown":function(){var F=B(this).index();E.select(F);E.$select.focus()},"mouseover.easyDropDown":function(){if(!E.keyboardMode){var F=B(this);F.addClass("focus").siblings().removeClass("focus");E.focusIndex=F.index()}},"mouseout.easyDropDown":function(){if(!E.keyboardMode){B(this).removeClass("focus")}}});E.$select.on({"focus.easyDropDown":function(){E.$container.addClass("focus");E.inFocus=true},"blur.easyDropDown":function(){E.$container.removeClass("focus");E.inFocus=false},"keydown.easyDropDown":function(H){if(E.inFocus){E.keyboardMode=true;var F=H.keyCode;if(F==38||F==40||F==32){H.preventDefault();if(F==38){E.focusIndex--;E.focusIndex=E.focusIndex<0?E.$items.length-1:E.focusIndex}else{if(F==40){E.focusIndex++;E.focusIndex=E.focusIndex>E.$items.length-1?0:E.focusIndex}}if(!E.down){E.open()}E.$items.removeClass("focus").eq(E.focusIndex).addClass("focus");if(E.cutOff){E.scrollToView()}E.query=""}if(E.down){if(F==9||F==27){E.close()}else{if(F==13){H.preventDefault();E.select(E.focusIndex);E.close();return false}else{if(F==8){H.preventDefault();E.query=E.query.slice(0,-1);E.search();clearTimeout(E.resetQuery);return false}else{if(F!=38&&F!=40){var G=String.fromCharCode(F);E.query+=G;E.search();clearTimeout(E.resetQuery)}}}}}}},"keyup.easyDropDown":function(){E.resetQuery=setTimeout(function(){E.query=""},1200)}});E.$dropDown.on("scroll.easyDropDown",function(F){if(E.$dropDown[0].scrollTop>=E.$dropDown[0].scrollHeight-E.maxHeight){E.$container.addClass("bottom")}else{E.$container.removeClass("bottom")}});if(E.$form.length){E.$form.on("reset.easyDropDown",function(){var F=E.hasLabel?E.label:E.options[0].title;E.$active.text(F)})}},unbindHandlers:function(){var E=this;E.$container.add(E.$select).add(E.$items).add(E.$form).add(E.$dropDown).off(".easyDropDown");B("body").off("."+E.id)},open:function(){var H=this,G=window.scrollY||document.documentElement.scrollTop,F=window.scrollX||document.documentElement.scrollLeft,E=H.notInViewport(G);H.closeAll();H.getMaxHeight();H.$select.focus();window.scrollTo(F,G+E);H.$container.addClass("open");H.$scrollWrapper.css("height",H.maxHeight+"px");H.down=true},close:function(){var E=this;E.$container.removeClass("open");E.$scrollWrapper.css("height","0px");E.focusIndex=E.selected.index;E.query="";E.down=false},closeAll:function(){var G=this,H=Object.getPrototypeOf(G).instances;for(var E in H){var F=H[E];F.close()}},select:function(H){var G=this;if(typeof H==="string"){H=G.$select.find("option[value="+H+"]").index()-1}var F=G.options[H],E=G.hasLabel?H+1:H;G.$items.removeClass("active").eq(H).addClass("active");G.$active.text(F.title);G.$select.find("option").removeAttr("selected").eq(E).prop("selected",true).parent().trigger("change");G.selected={index:H,title:F.title};G.focusIndex=i;if(typeof G.onChange==="function"){G.onChange.call(G.$select[0],{title:F.title,value:F.value})}},search:function(){var H=this,G=function(I){H.focusIndex=I;H.$items.removeClass("focus").eq(H.focusIndex).addClass("focus");H.scrollToView()},F=function(I){return H.options[I].title.toUpperCase()};for(i=0;i<H.options.length;i++){var E=F(i);if(E.indexOf(H.query)==0){G(i);return}}for(i=0;i<H.options.length;i++){var E=F(i);if(E.indexOf(H.query)>-1){G(i);break}}},scrollToView:function(){var G=this;if(G.focusIndex>=G.cutOff){var E=G.$items.eq(G.focusIndex),F=(E.outerHeight()*(G.focusIndex+1))-G.maxHeight;G.$dropDown.scrollTop(F)}},notInViewport:function(H){var G=this,E={min:H,max:H+(window.innerHeight||document.documentElement.clientHeight)},F=G.$dropDown.offset().top+G.maxHeight;if(F>=E.min&&F<=E.max){return 0}else{return(F-E.max)+5}},destroy:function(){var E=this;E.unbindHandlers();E.$select.unwrap().siblings().remove();E.$select.unwrap();delete Object.getPrototypeOf(E).instances[E.$select[0].id]},disable:function(){var E=this;E.disabled=true;E.$container.addClass("disabled");E.$select.attr("disabled",true);if(!E.down){E.close()}},enable:function(){var E=this;E.disabled=false;E.$container.removeClass("disabled");E.$select.attr("disabled",false)}};var C=function(G,E){G.id=!G.id?"EasyDropDown"+A():G.id;var F=new D();if(!F.instances[G.id]){F.instances[G.id]=F;F.init(G,E)}},A=function(){return("00000"+(Math.random()*16777216<<0).toString(16)).substr(-6).toUpperCase()};B.fn.easyDropDown=function(){var F=arguments,E=[],G;G=this.each(function(){if(F&&typeof F[0]==="string"){var H=D.prototype.instances[this.id][F[0]](F[1],F[2]);if(H){E.push(H)}}else{C(this,F[0])}});if(E.length){return E.length>1?E:E[0]}else{return G}};B(function(){if(typeof Object.getPrototypeOf!=="function"){if(typeof"test".__proto__==="object"){Object.getPrototypeOf=function(E){return E.__proto__}}else{Object.getPrototypeOf=function(E){return E.constructor.prototype}}}B("select.dropdown").each(function(){var E=B(this).attr("data-settings");settings=E?B.parseJSON(E):{};C(this,settings)})})})(jQuery);